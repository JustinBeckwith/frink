<?xml version="1.0" encoding="utf-8"?>
<s:SkinnableContainer xmlns:fx="http://ns.adobe.com/mxml/2009" 
					  xmlns:s="library://ns.adobe.com/flex/spark" width="100%" height="100%" creationComplete="creationCompleteHandler(event)">
		
	<fx:Script>
		<![CDATA[
			import events.RedditEvent;
			
			import mx.collections.ArrayCollection;
			import mx.events.FlexEvent;
			import mx.events.PropertyChangeEvent;
			
			import spark.components.VScrollBar;
			
			//--------------------------------------------------------------------------
			//
			//  Variables
			//
			//--------------------------------------------------------------------------
			
			/**
			 * list of posts to bind
			 **/
			[Bindable]
			protected var comments : ArrayCollection = new ArrayCollection();

			/**
			 * the currently selected post in the list
			 **/
			[Bindable]
			public var post : Object;
			
			
			//--------------------------------------------------------------------------
			//
			//  Methods
			//
			//--------------------------------------------------------------------------
			
			/**
			 * use the reddit api to load all posts
			 **/
			public function loadComments(post : Object) : void {
				this.post = post;
				this.comments.removeAll();
				FrinkData.instance.api.loadComments(post);
			}
			
			//--------------------------------------------------------------------------
			//
			//  Event Handlers
			//
			//--------------------------------------------------------------------------
			
			/**
			 * set up the event listener
			 **/
			protected function creationCompleteHandler(event:FlexEvent) : void {
				FrinkData.instance.api.addEventListener(RedditEvent.COMMENTS_LOADED, api_commentsLoaded);
			} 
			
			/**
			 * bind the posts to the list
			 **/
			protected function api_commentsLoaded(event : RedditEvent) : void {
				
				// comment results are returned as a two element array:  the first element is the post details,
				// and the second element is the array of comments
				
				// get the posts returned in the list
				var records : Array = (event.result as Array)[1].data.children as Array;
				comments.addAll(new ArrayCollection(records));
			}
			
			
			/**
			 * add a scroll handler to the list after created manually
			 **/
			protected function list_creationCompleteHandler(event:FlexEvent):void
			{
				//list.scroller.verticalScrollBar.addEventListener(Event.CHANGE, list_verticalScrollBar_change);
				// Does not work with mouse wheel or arrow buttons due to bug http://bugs.adobe.com/jira/browse/SDK-26533
				/* list.scroller.verticalScrollBar.addEventListener( Event.CHANGE, verticalScrollBarChangeHandler ); */
				list.scroller.viewport.addEventListener( PropertyChangeEvent.PROPERTY_CHANGE, propertyChangeHandler );
			}
			
			/**
			 * list scroll event
			 **/
			protected function propertyChangeHandler( event : PropertyChangeEvent ) : void {
				if ( event.property == "verticalScrollPosition" ) {
					var vsb:VScrollBar = list.scroller.verticalScrollBar;
					if (vsb.value == vsb.maximum) {
						// load the next page of posts if at the bottom of the list
						//FrinkData.instance.api.loadComments(this.subReddit, null, this.page_after);
					}
				}
			}
			
		]]>
	</fx:Script>
	
	<s:List width="100%" height="100%" contentBackgroundColor="0xCCCCCC" id="list" dataProvider="{comments}" creationComplete="list_creationCompleteHandler(event)" itemRenderer="views.renderers.CommentDetails" />
	
</s:SkinnableContainer>
