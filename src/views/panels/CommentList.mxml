<?xml version="1.0" encoding="utf-8"?>
<s:SkinnableContainer xmlns:fx="http://ns.adobe.com/mxml/2009" 
					  xmlns:s="library://ns.adobe.com/flex/spark" width="100%" height="100%" 
					  backgroundColor="0xFFFFFF"
					  creationComplete="creationCompleteHandler(event)">
		
	<fx:Script>
		<![CDATA[
			import events.RedditEvent;
			
			import mx.collections.ArrayCollection;
			import mx.events.FlexEvent;
			import mx.events.PropertyChangeEvent;
			
			import spark.components.VScrollBar;
			
			//--------------------------------------------------------------------------
			//
			//  Variables
			//
			//--------------------------------------------------------------------------
			
			/**
			 * list of posts to bind
			 **/
			[Bindable]
			protected var comments : ArrayCollection = new ArrayCollection();

			/**
			 * the currently selected post in the list
			 **/
			[Bindable]
			public var post : Object;
			
			/**
			 * the header to the comments data structure
			 **/
			[Bindable]
			public var selfObject : Object;
			
			[Bindable]
			public var showSelfHeader : Boolean;
			
			
			//--------------------------------------------------------------------------
			//
			//  Methods
			//
			//--------------------------------------------------------------------------
			
			/**
			 * use the reddit api to load all posts
			 **/
			public function loadComments(post : Object) : void {
				this.post = post;
				this.selfObject = null;
				this.showSelfHeader = false;
				this.comments.removeAll();
				FrinkData.instance.api.loadComments(post);
			}
			
			//--------------------------------------------------------------------------
			//
			//  Event Handlers
			//
			//--------------------------------------------------------------------------
			
			/**
			 * set up the event listener
			 **/
			protected function creationCompleteHandler(event:FlexEvent) : void {
				FrinkData.instance.api.addEventListener(RedditEvent.COMMENTS_LOADED, api_commentsLoaded);
			} 
			
			/**
			 * bind the posts to the list
			 **/
			protected function api_commentsLoaded(event : RedditEvent) : void {
				
				// comment results are returned as a two element array:  the first element is the post details,
				// and the second element is the array of comments
				
				// get the posts returned in the list
				var records : Array = (event.result as Array)[1].data.children as Array;
				comments.addAll(new ArrayCollection(records));
				
				// get the header obj that contains basic post info
				this.selfObject = (event.result as Array)[0].data.children[0];
				this.showSelfHeader = selfObject != null && selfObject.data.selftext != null && selfObject.data.selftext != '';
			}	
		]]>
	</fx:Script>
			
	<s:Scroller width="100%" height="100%">
		<s:VGroup width="100%" height="100%">
			
			<s:SkinnableContainer width="100%" visible="{showSelfHeader}" includeInLayout="{showSelfHeader}">
				<s:Line left="0" right="0" bottom="0">
					<s:stroke>
						<s:SolidColorStroke color="0x000000" />
					</s:stroke>
				</s:Line>
				<s:Label width="100%" text="{selfObject.data.selftext}" color="0x000000" fontSize="14" 
						 paddingTop="10" paddingBottom="10" paddingLeft="10" paddingRight="10"	/>
			</s:SkinnableContainer>
			
			
			<s:DataGroup width="100%" height="100%" id="list" dataProvider="{comments}" itemRenderer="views.renderers.CommentDetails">
				<s:layout>
					<s:VerticalLayout />
				</s:layout>
			</s:DataGroup>
		</s:VGroup>
	</s:Scroller>
	
</s:SkinnableContainer>
